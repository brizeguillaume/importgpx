<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ironman 70.3 Mont-Tremblant</title>
    <style>
        :root {
            --primary: #e63946;
            --dark: #1d3557;
            --light: #f1faee;
            --accent: #a8dadc;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Open Sans', sans-serif;
            color: white;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.7)), 
                        url('https://images.unsplash.com/photo-1579033462043-0f11a7862f7d?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .title-container {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        h1 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 3.5rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            color: var(--primary);
        }
        
        h2 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 2rem;
            margin-top: 0.5rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="title-container">
                <h1>IRONMAN 70.3</h1>
                <h2>Mont-Tremblant - 25 Juin 2025</h2>
            </div>
            
            <div class="countdown" id="countdown">
                <div class="countdown-box">
                    <div class="countdown-value" id="days">00</div>
                    <div class="countdown-label">Jours</div>
                </div>
                <div class="countdown-box">
                    <div class="countdown-value" id="hours">00</div>
                    <div class="countdown-label">Heures</div>
                </div>
                <div class="countdown-box">
                    <div class="countdown-value" id="minutes">00</div>
                    <div class="countdown-label">Minutes</div>
                </div>
                <div class="countdown-box">
                    <div class="countdown-value" id="seconds">00</div>
                    <div class="countdown-label">Secondes</div>
                </div>
            </div>
            
            <div class="motivation" id="motivation">
                "Votre limite est là où vous la placez"
            </div>
        </header>
        
        <div class="dashboard">
            <div id="map" style="height: 400px; border-radius: 10px; margin: 2rem 0; border: 3px solid white;"></div>
            
            <div class="stats" style="display: flex; gap: 10px; margin: 1rem 0; flex-wrap: wrap;">
                <div class="stat-card" style="background: var(--primary); color: white; padding: 1rem; border-radius: 8px; flex: 1; min-width: 120px; text-align: center;">
                    <div id="distance">0 km</div>
                    <small>Distance</small>
                </div>
                <div class="stat-card" style="background: var(--primary); color: white; padding: 1rem; border-radius: 8px; flex: 1; min-width: 120px; text-align: center;">
                    <div id="duration">0 min</div>
                    <small>Durée</small>
                </div>
                <div class="stat-card" style="background: var(--primary); color: white; padding: 1rem; border-radius: 8px; flex: 1; min-width: 120px; text-align: center;">
                    <div id="elevation">0 m</div>
                    <small>Dénivelé</small>
                </div>
            </div>
            
            <div class="upload-section" style="background: rgba(255,255,255,0.9); padding: 1.5rem; border-radius: 10px; margin: 2rem 0; border: 2px dashed var(--dark);">
                <h3 style="color: var(--dark); margin-top: 0;">Importer votre entraînement GPX</h3>
                <input type="file" id="gpxFileInput" accept=".gpx" style="display: none;">
                <button id="uploadBtn" style="background: var(--primary); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 50px; font-weight: bold; cursor: pointer;">
                    <i class="fas fa-upload"></i> Choisir un fichier
                </button>
                <div id="fileList" style="margin-top: 1rem; color: var(--dark);"></div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 2rem;">
                <div>
                    <canvas id="elevationChart"></canvas>
                </div>
                <div>
                    <canvas id="speedChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Configuration
        const EVENT_DATE = new Date("June 25, 2025 07:00:00");
        const MAP_CENTER = [46.2127, -74.5824];
        const MAP_ZOOM = 12;
        
        // Éléments DOM
        const dom = {
            map: null,
            uploadBtn: document.getElementById('uploadBtn'),
            gpxInput: document.getElementById('gpxFileInput'),
            fileList: document.getElementById('fileList'),
            charts: {
                elevation: null,
                speed: null
            }
        };
        
        // Données
        let currentWorkout = null;
        
        // Initialisation
        function init() {
            setupEventListeners();
            initMap();
            initCharts();
            startCountdown();
            startMotivationalQuotes();
        }
        
        function setupEventListeners() {
            dom.uploadBtn.addEventListener('click', () => dom.gpxInput.click());
            dom.gpxInput.addEventListener('change', handleFileUpload);
        }
        
        function initMap() {
            dom.map = L.map('map').setView(MAP_CENTER, MAP_ZOOM);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(dom.map);
            
            // Marqueur d'arrivée
            L.marker([46.1200, -74.6000])
                .addTo(dom.map)
                .bindPopup("Ligne d'arrivée")
                .openPopup();
        }
        
        function initCharts() {
            dom.charts.elevation = new Chart(
                document.getElementById('elevationChart'),
                {
                    type: 'line',
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Profil d\'altitude (m)' }
                        }
                    }
                }
            );
            
            dom.charts.speed = new Chart(
                document.getElementById('speedChart'),
                {
                    type: 'line',
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Vitesse (km/h)' }
                        }
                    }
                }
            );
        }
        
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            dom.fileList.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Analyse en cours...</p>';
            
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    currentWorkout = parseGPX(event.target.result, file.name);
                    updateUI();
                    dom.fileList.innerHTML = `<p style="color: green;"><i class="fas fa-check-circle"></i> ${file.name} analysé</p>`;
                } catch (error) {
                    dom.fileList.innerHTML = `<p style="color: red;"><i class="fas fa-exclamation-circle"></i> Erreur: ${error.message}</p>`;
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }
        
        function parseGPX(gpxText, filename) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(gpxText, "text/xml");
            const trkpts = Array.from(xmlDoc.querySelectorAll('trkpt'));
            
            if (trkpts.length === 0) {
                throw new Error("Aucune donnée GPS trouvée");
            }
            
            const points = trkpts.map(pt => {
                return {
                    lat: parseFloat(pt.getAttribute('lat')),
                    lon: parseFloat(pt.getAttribute('lon')),
                    ele: parseFloat(pt.querySelector('ele')?.textContent || 0)
                };
            });
            
            return {
                filename,
                points,
                startTime: trkpts[0]?.querySelector('time')?.textContent
            };
        }
        
        function updateUI() {
            if (!currentWorkout) return;
            
            // Mise à jour carte
            if (dom.map) {
                dom.map.eachLayer(layer => {
                    if (layer instanceof L.Polyline) dom.map.removeLayer(layer);
                });
                
                const latLngs = currentWorkout.points.map(p => [p.lat, p.lon]);
                L.polyline(latLngs, { color: 'red' }).addTo(dom.map);
                dom.map.fitBounds(latLngs);
            }
        }
        
        function startCountdown() {
            function update() {
                const now = new Date();
                const diff = EVENT_DATE - now;
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const secs = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('days').textContent = days;
                document.getElementById('hours').textContent = hours;
                document.getElementById('minutes').textContent = mins;
                document.getElementById('seconds').textContent = secs;
            }
            
            update();
            setInterval(update, 1000);
        }
        
        function startMotivationalQuotes() {
            const quotes = [
                "La douleur est temporaire, la fierté est éternelle.",
                "Ce qui ne vous tue pas vous rend plus fort.",
                "Le succès est la somme de petits efforts répétés.",
                "Votre limite est là où vous la placez."
            ];
            
            function update() {
                const quote = quotes[Math.floor(Math.random() * quotes.length)];
                document.getElementById('motivation').textContent = `"${quote}"`;
            }
            
            update();
            setInterval(update, 10000);
        }
        
        // Lancement
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>